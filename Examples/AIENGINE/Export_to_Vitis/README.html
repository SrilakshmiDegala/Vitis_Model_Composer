<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="/proj/xcoswmktg/robg/git/markdown_to_html/style.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<section id="export-ai-engine-design-from-vitis-model-composer-to-vitis"
class="level1">
<h1>Export AI Engine Design from Vitis Model Composer to Vitis</h1>
<p>In this tutorial, we will show how to export an AI Engine design into
a Vitis system project after it has been simulated and validated in
Vitis Model Composer.</p>
<p>In the early stages of the development cycle, it is critical to
verify the functional behavior of the AI Engine kernels and graph. Vitis
Model Composer is an ideal choice for testing and debugging at this
level because of the speed of iteration and the high level of data
visibility it provides the AI Engine developer.</p>
<p>To run on Versal hardware, the finished AI Engine design must be
linked to data movers running on the PL and a host application running
on the PS. This linking step, as well as the subsequent packaging of the
finished hardware image, is accomplished via a Vitis project.</p>
<p>There are 2 ways to export an AI Engine design from Vitis Model
Composer:</p>
<ol type="1">
<li><p><strong>Generate Code</strong>: This generates the AI Engine
graph and kernel code for the AI Engine design. This approach does not
require a pre-existing Vitis platform. The exported code can be brought
into Vitis as an <strong>AI Engine Component</strong>.</p></li>
<li><p><strong>Generate libadf.a</strong>: In addition to the above,
Vitis Model Composer runs the AI Engine code through the AI Engine
Compiler to produce a libadf.a. Vitis Model Composer also produces HLS
C++ source code for datamovers and a connectivity graph (.cfg file) that
describes how the AI Engine and datamovers are connected. This approach
requires a pre-existing base or custom Vitis platform. The build
artifacts can be brought into Vitis as a <strong>System
Project</strong>.</p></li>
</ol>
<p>This tutorial will describe both approaches.</p>
<section id="tutorial-system-design" class="level2">
<h2>Tutorial System Design</h2>
<p>The design that will be used is shown in the following figure:</p>
<p><img src="./Images/lab8_system_diagram.png" /></p>
<p>The AI Engine part of the design, consisting of the Interpolator,
Polarclip, and Classifier kernels, is simulated by and generated from
Vitis Model Composer.</p>
</section>
<section id="examine-the-ai-engine-design" class="level2">
<h2>Examine the AI Engine Design</h2>
<p>Open and run the Vitis Model Composer testbench for the AI Engine
part of the design.</p>
<pre><code>open_system(&#39;aie_testbench&#39;);
sim(&#39;aie_testbench&#39;);</code></pre>
<p>This model implements the AI Engine processing cascade using AIE
Kernel blocks. The output of simulating the AI Engine processing cascade
is compared to a reference output. The AI Engine output is also
displayed on a scope. To see how the input and reference output data is
loaded into Model Composer, go to the <strong>Simulink toolstrip -&gt;
Modeling -&gt; Model Settings -&gt; Model Properties -&gt; Callbacks
-&gt; PostLoadFcn</strong>.</p>
<p>After simulating the processing chain and verifying its
functionality, it can be exported to Vitis for integration into a larger
project.</p>
</section>
<section id="approach-1-ai-engine-component" class="level2">
<h2>Approach 1: AI Engine Component</h2>
<section id="generate-ai-engine-code" class="level3">
<h3>Generate AI Engine Code</h3>
<p>First, we will generate AI Engine graph code from the design in Vitis
Model Composer.</p>
<ol type="1">
<li><p>In the <code>aie_testbench</code> model, double-click on the
<strong>Vitis Model Composer</strong> <strong>Hub</strong>
block.</p></li>
<li><p>Ensure that the Hub block is configured as follows for the
<code>ai_engine</code> subsystem.</p></li>
</ol>
<p><img src="Images/vmc1.png" /></p>
<ol start="3" type="1">
<li>Click <strong>Generate</strong>.</li>
</ol>
<p>Wait for code generation to complete.</p>
<p><img src="Images/vmc2.png" /></p>
<p>After code generation is complete, explore the contents of the
generated <code>code</code> folder:</p>
<p><img src="Images/vmc3.png" /></p>
<p>The generated code folder contains a folder called <code>ip</code>
that contains subfolders for each AI Engine and HLS IP in the design.
Each individual IP subfolder contains a <code>src</code> folder
containing the IP's source code. In this design, the
<code>ip/ai_engine/src</code> folder contains the AI Engine code we will
bring into Vitis as a component.</p>
</section>
<section id="create-ai-engine-component-in-vitis" class="level3">
<h3>Create AI Engine Component in Vitis</h3>
<p>Next, we will create a new Vitis workspace and add an AI Engine
component to it.</p>
<ol type="1">
<li><p>Open a Linux terminal in this tutorial directory.</p></li>
<li><p>Configure your shell to run Vitis:
<code>source (path to Xilinx installation)/Vitis/2023.2/settings64.sh</code>.</p></li>
<li><p>Start the Vitis IDE: <code>vitis -w work &amp;</code>.</p></li>
</ol>
<p>This creates a new folder called <code>work</code> in the current
folder and opens it as a Vitis workspace. The Vitis Unified IDE opens to
the Welcome page.</p>
<ol start="4" type="1">
<li>The Workspace panel on the left side identifies the
<code>work</code> folder as the current workspace. The workspace is
currently empty. Select <strong>Create AI Engine
Component</strong>.</li>
</ol>
<p><img src="Images/vitis2.png" /></p>
<ol start="5" type="1">
<li>Leave the component name and location as their defaults. Click
<strong>Next</strong>.</li>
</ol>
<p><img src="Images/vitis3.png" /></p>
<ol start="6" type="1">
<li>Select the <strong>Add Folder</strong> button under Import
Sources.</li>
</ol>
<p><img src="Images/vitis4.png" /></p>
<ol start="7" type="1">
<li><p>Add the <code>src</code> folder from the AI Engine IP that you
generated from Vitis Model Composer.</p></li>
<li><p>Make sure the top-level file is <code>src/ai_engine.cpp</code>.
Click <strong>Next</strong>.</p></li>
</ol>
<p><img src="Images/vitis5.png" /></p>
<ol start="9" type="1">
<li>Select a part, platform, or hardware design. In the screenshot
below, the VCK190 base platform is selected. Click
<strong>Next</strong>.</li>
</ol>
<p><img src="Images/vitis6.png" /></p>
<ol start="10" type="1">
<li>On the Summary screen, click <strong>Next</strong>.</li>
</ol>
<p>The AI Engine Component is created in the Vitis workspace.</p>
<p><img src="Images/vitis7.png" /></p>
</section>
<section id="configure-and-build-ai-engine-component" class="level3">
<h3>Configure and Build AI Engine Component</h3>
<p>Our AI Engine design in Vitis Model Composer was implemented using
custom kernel code. Before building the AI Engine component, it is
necessary to add the path to that kernel code to the component's include
path.</p>
<ol type="1">
<li><p>Double-click the file <code>aiecompiler.cfg</code> in the AI
Engine Component.</p></li>
<li><p>Under Include Directory, click <strong>Add
Item</strong>.</p></li>
<li><p>Add this example's folder to the include path:</p></li>
</ol>
<p><img src="Images/vitis8.png" /></p>
<blockquote>
<p>If your AI Engine design contains blocks from the Vitis Model
Composer AI Engine DSP library, you must add the following locations to
the include path:</p>
<ul>
<li><code>./xmc_aie_lib</code></li>
<li><code>(Model Composer install location)/tps/xf_dsp/L1/src/aie</code></li>
<li><code>(Model Composer install location)/tps/xf_dsp/L1/include/aie</code></li>
<li><code>(Model Composer install location)/tps/xf_dsp/L2/include/aie</code></li>
</ul>
<p>The Model Composer install location can be found by typing
<code>xmcPathInfo</code> in the MATLAB Command Window.</p>
</blockquote>
<ol start="4" type="1">
<li>To build the AI Engine Component, in the Flow Navigator select
<strong>AIE Simulator/Hardware -&gt; Build</strong>.</li>
</ol>
<p><img src="Images/vitis9.png" /></p>
<p>After the build completes, confirm that
<code>Build Finished successfully</code> appears in the Output console.
The build outputs, including the <code>libadf.a</code>, are visible in
the component workspace.</p>
<p><img src="Images/vitis10.png" /></p>
<p>You can now continue working with this component in Vitis, including
debugging and integrating with other components to build a system
project.</p>
</section>
</section>
<section id="approach-2-vitis-system-project" class="level2">
<h2>Approach 2: Vitis System Project</h2>
</section>
</section>
</body>
</html>
